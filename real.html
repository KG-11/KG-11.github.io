<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Map - Limit map&#x27;s extent</title>
<style type="text/css">
html,
body {
    margin: 0px;
    height: 100%;
    width: 100%
}

.container {
    width: 100%;
    height: 100%
}

.pane {
    background: #34495e;
    line-height: 28px;
    color: #fff;
    z-index: 10;
    position: absolute;
    top: 20px;
    right: 20px
}

.pane a {
    display: block;
    color: #fff;
    text-align: left;
    padding: 0 10px;
    min-width: 28px;
    min-height: 28px;
    float: left
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maptalks/dist/maptalks.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/maptalks/dist/maptalks.min.js"></script>
<script type="text/javascript" src="./maptalks-config.js"></script>
<script type="text/javascript" src="./tree-config.js"></script>

<body>
    <div id="map" class="container"></div>
    <div class="pane">
        <a href="./index.html">Index3</a>
        <h6 id="accuracy_ml"></h6>
    </div>
    <script>
    // Spoof Location
    // var position = {};
    // var latitude = 13.10885;
    // var longitude = 80.18646;

    // let i = 0;
    var marker;
    var layer;
    var GPS_OPTIONS = {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
    };
    // Basic map configuration.
    var map = new maptalks.Map('map', {
        center: maptalksConfig.centerCoords,
        zoom: 19,
        // minZoom: 19, // set map's min zoom to 14
        // maxZoom: 20,
        pitch: 60,
        bearing: 25,
        centerCross: false,
        baseLayer: new maptalks.TileLayer('base', {
            urlTemplate: maptalksConfig.urlTemplate,
            subdomains: maptalksConfig.subdomains,
            attribution: maptalksConfig.attribution
        })
    });

    // Checking for user's location.
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(checkIfUserIsNearTheTree, error, GPS_OPTIONS);
        // move();
    } else {
        alert("Location is not enabled. Please enalble location in your device and refresh the page.")
    }

    function checkIfUserIsNearTheTree(position) {
        var crd = position.coords;
        uLat = crd.latitude;
        ulon = crd.longitude;
        acc = crd.accuracy;

        //checkIfUserIsNearTheTree(userLat, userLon);
        console.log('Your current position is:');
        console.log(`Latitude : ${crd.latitude}`);
        console.log(`Longitude: ${crd.longitude}`);
        console.log(`More or less ${crd.accuracy} meters.`);
        document.getElementById('accuracy_ml').innerHTML = `More or less ${crd.accuracy} meters.`;
        navigator.geolocation.watchPosition(updatePosition, error);
    }

    function error(err) {
        console.warn(`ERROR(${err.code}): ${err.message}`);
    }

    function updatePosition(position) {
        userLat = position.coords.latitude;
        userLon = position.coords.longitude;
        // i++;
        marker = new maptalks.Circle([userLon, userLat], 5, {
            'symbol': {
                lineColor: '#34495e',
                lineWidth: 0,
                polygonFill: 'rgb(135,196,240)',
                polygonOpacity: 1
            },
            properties: {
                altitude: 0
            }
        });

        if (layer != undefined || layer != '' || layer != null) {
            map.removeLayer(layer);
            layer = new maptalks.VectorLayer('vector', { enableAltitude: true }).addGeometry([marker]).addTo(map);
        } else {
            layer = new maptalks.VectorLayer('vector', { enableAltitude: true }).addGeometry([marker]).addTo(map);
        }


    }
    </script>
</body>

</html>
